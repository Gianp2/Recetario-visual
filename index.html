<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="img/logococina.webp" href="img/favicon.ico">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/style.css">
    <title>Recetas de Cocina</title>
    <style>
        .info-section {
            max-width: 700px;
            margin: 2rem auto;
            padding: 2rem;
            background: linear-gradient(135deg, #1B5E20 0%, #2E7D32 30%, #388E3C 60%, #43A047 100%);            
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #1B5E20;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .info-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .info-section h2 {
            font-size: 2rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 1.5rem;
            text-align: center;
            letter-spacing: 1px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }

        .info-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            padding: 1rem;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255, 255, 255, 0.9);
            padding: 1.2rem;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .info-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .icon {
            font-size: 2.5rem;
            color: #2E7D32;
            flex-shrink: 0;
        }

        .info-item p {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 500;
            color: #1B5E20;
        }

        .info-item a {
            color: #1B5E20;
            text-decoration: none;
            font-weight: 600;
        }

        .info-item a:hover {
            text-decoration: underline;
            color: #388E3C;
        }

        .info-item ul {
            margin: 0.5rem 0 0 0;
            padding-left: 1.2rem;
            color: #33691E;
            font-weight: 500;
            font-size: 1rem;
        }

        .info-item ul li {
            margin-bottom: 0.3rem;
        }

        .create-recipe-btn {
            display: block;
            margin: 1.5rem auto 2rem auto;
            padding: 20px 40px;
            cursor: pointer;
            border: none;
            border-radius: 9999px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
            box-shadow: 0 4px 12px rgba(37, 117, 252, 0.5);
            transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
            width: auto;
            min-width: 200px;
            text-align: center;
            white-space: nowrap;
        }

        .create-recipe-btn:hover {
            background: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%);
            box-shadow: 0 6px 16px rgba(106, 17, 203, 0.7);
            transform: scale(1.05);
        }

        .create-recipe-btn:active {
            transform: scale(0.95);
        }

        .inventory-section {
            max-width: 700px;
            margin: 2rem auto;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .inventory-section h2 {
            font-size: 1.8rem;
            color: #1B5E20;
            margin-bottom: 1rem;
        }

        .inventory-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .inventory-table th, .inventory-table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .inventory-table th {
            background-color: #2E7D32;
            color: white;
        }

        .low-stock {
            color: red;
            font-weight: bold;
        }

        .inventory-form label {
            display: block;
            margin: 0.5rem 0 0.2rem;
            font-weight: 500;
        }

        .inventory-form input, .inventory-form textarea {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .inventory-form button {
            padding: 0.5rem 1rem;
            background-color: #43A047;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .inventory-form button:hover {
            background-color: #388E3C;
        }

        .inventory-table button {
            padding: 0.3rem 0.6rem;
            margin: 0 0.2rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .inventory-table .edit-btn {
            background-color: #2575fc;
            color: white;
        }

        .inventory-table .delete-btn {
            background-color: #d9534f;
            color: white;
        }
    </style>
</head>
<header>
    <section class="info-section">
        <h2>Informaci√≥n de Contacto</h2>
        <div class="info-container">
            <div class="info-item">
                <span class="icon">üè´</span>
                <p><strong>Escuela Especial 2031 - Mar√≠a Molina de Albonico</strong></p>
            </div>
            <div class="info-item">
                <span class="icon">üìç</span>
                <p><strong>Direcci√≥n:</strong> Necochea 94, 2500 Ca√±ada de G√≥mez, IRIONDO</p>
            </div>
            <div class="info-item">
                <span class="icon">‚òéÔ∏è</span>
                <p><strong>Tel√©fono:</strong> 03471 423615</p>
            </div>
            <div class="info-item">
                <span class="icon">üïí</span>
                <div>
                    <p><strong>Horarios:</strong></p>
                    <ul>
                        <li><strong>Lunes a Viernes:</strong> 08:00 - 17:00</li>
                        <li><strong>S√°bado:</strong> Cerrado</li>
                        <li><strong>Domingo:</strong> Cerrado</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>
    
    <button id="scrollToContentBtn" class="create-recipe-btn">
        CREA TU RECETA! üëá
    </button>
</header>

<body>
    <main id="mainContent">
        <h2>ARM√Å TU RECETA üìù</h2>
        <p>Este espacio es para que vos, <span>Chef</span> üë®üèª‚Äçüç≥, puedas cargar tus recetas.</p>

        <section class="inventory-section">
            <h2>GESTI√ìN DE INVENTARIO</h2>
            <form id="inventory-form">
                <label for="inventory-item">Nombre del √≠tem:</label>
                <input type="text" id="inventory-item" required>
                <label for="inventory-quantity">Cantidad:</label>
                <input type="text" id="inventory-quantity" placeholder="Ej: 3 kg" required>
                <label for="inventory-message">Mensaje/Nota:</label>
                <textarea id="inventory-message" placeholder="Ej: Falta reponer arroz"></textarea>
                <button type="submit">AGREGAR/EDITAR √çTEM</button>
            </form>
            <table class="inventory-table">
                <thead>
                    <tr>
                        <th>√çtem</th>
                        <th>Cantidad</th>
                        <th>Mensaje</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="inventory-list"></tbody>
            </table>
        </section>

        <section class="form-section">
            <h2>CREAR RECETA</h2>
            <form id="recipe-form">
                <label for="recipe-name">NOMBRE DE LA RECETA:</label>
                <input type="text" id="recipe-name" required>

                <label for="ingredient-search">BUSCAR INGREDIENTES:</label>
                <input type="text" id="ingredient-search" placeholder="Escribe para buscar...">

                <label for="ingredient-select">SELECCIONAR INGREDIENTES:</label>
                <select id="ingredient-select" multiple></select>

                <button type="button" id="add-ingredients-btn">A√ëADIR INGREDIENTES</button>
                <div id="selected-ingredients"></div>

                <label for="steps">PASOS:</label>
                <textarea id="steps" required></textarea>

                <button type="submit">GUARDAR RECETA</button>
            </form>
        </section>

        <section class="add-ingredient-section">
            <h2>AGREGAR NUEVO INGREDIENTE</h2>
            <form id="add-ingredient-form">
                <label for="new-ingredient-name">Nombre del ingrediente:</label>
                <input type="text" id="new-ingredient-name" required>
                <label for="new-ingredient-image">URL de la imagen (o ruta local, ej. img/nuevo.jpg):</label>
                <input type="text" id="new-ingredient-image" placeholder="Ej: img/acelga.jpg o https://ejemplo.com/imagen.jpg" required>
                <button type="submit">AGREGAR INGREDIENTE</button>
            </form>
        </section>

        <section id="recipes-section">
            <h2>RECETAS GUARDADAS</h2>
            <div id="recipes-list"></div>
        </section>

        <section class="recipes-section">
            <div id="recipeList"></div>
            <button id="clearRecipes">BORRAR TODAS LAS RECETAS</button>
        </section>

        <section id="comments-section">
            <h2>COMENTARIOS</h2>
            <form id="comment-form">
                <label for="name">Nombre:</label>
                <input type="text" id="name" required>
                <label for="email">Correo:</label>
                <input type="text" id="email" required>
                <label for="comment">Deja tu comentario:</label>
                <textarea id="comment" required></textarea>
                <button type="submit">Enviar Comentario</button>
            </form>
            <div id="comments-list"></div>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Traducci√≥n de ingredientes
        const ingredientTranslations = {
            "Aceite": "Oil",
            "Acelga": "Chard",
            "Aguacate": "Avocado",
            "Albahaca": "Basil",
            "Almendras": "Almonds",
            "Anacardos": "Cashews",
            "Apio": "Celery",
            "Arroz": "Rice",
            "At√∫n": "Tuna",
            "Azafr√°n": "Saffron",
            "Az√∫car": "Sugar",
            "Bacon": "Bacon",
            "Berenjena": "Eggplant",
            "Br√≥coli": "Broccoli",
            "Cacahuetes": "Peanuts",
            "Calabac√≠n": "Zucchini",
            "Calamares": "Squid",
            "Canela": "Cinnamon",
            "Cardamomo": "Cardamom",
            "Carne de Cerdo": "Pork",
            "Carne de Cordero": "Lamb",
            "Carne de Ternera": "Veal",
            "Cebolla": "Onion",
            "Cereza": "Cherry",
            "Cerdo": "Pork",
            "Champi√±ones": "Mushrooms",
            "Chocolate": "Chocolate",
            "Cilantro": "Cilantro",
            "Ciruela": "Plum",
            "Clavo": "Clove",
            "Coles de Bruselas": "Brussels Sprouts",
            "Coliflor": "Cauliflower",
            "Coco": "Coconut",
            "Comino": "Cumin",
            "Cordero": "Lamb",
            "Harina de Ma√≠z": "Corn Flour",
            "Crema": "Cream",
            "Durazno": "Peach",
            "Esp√°rragos": "Asparagus",
            "Espinaca": "Spinach",
            "Fresa": "Strawberry",
            "Frijoles": "Beans",
            "Garbanzos": "Chickpeas",
            "Guisantes": "Peas",
            "Harina": "Flour",
            "Harina de Avena": "Oat Flour",
            "Harina de Ma√≠z": "Corn Flour",
            "Harina Integral": "Whole Wheat Flour",
            "Habas": "Broad Beans",
            "Hinojo": "Fennel",
            "Hinojo (semillas)": "Fennel Seeds",
            "Huevo": "Egg",
            "Jam√≥n": "Ham",
            "Jengibre": "Ginger",
            "Kale": "Kale",
            "Kiwi": "Kiwi",
            "Lechuga": "Lettuce",
            "Leche": "Milk",
            "Levadura": "Yeast",
            "Lim√≥n": "Lemon",
            "Lentejas": "Lentils",
            "Ma√≠z": "Corn",
            "Mango": "Mango",
            "Manteca": "Butter",
            "Manzana": "Apple",
            "Maracuy√°": "Passion Fruit",
            "Mascarpone": "Mascarpone",
            "Mejill√≥n": "Mussel",
            "Mel√≥n": "Melon",
            "Miel": "Honey",
            "Mostaza": "Mustard",
            "Naranja": "Orange",
            "Nata": "Heavy Cream",
            "Nuez Moscada": "Nutmeg",
            "Nueces": "Walnuts",
            "Or√©gano": "Oregano",
            "Pan": "Bread",
            "Papa": "Potato",
            "Papaya": "Papaya",
            "Paprika": "Paprika",
            "Pasta": "Pasta",
            "Pepino": "Cucumber",
            "Pera": "Pear",
            "Perejil": "Parsley",
            "Pescado": "Fish",
            "Pimiento": "Pepper",
            "Pimienta": "Pepper",
            "Pimienta de Cayena": "Cayenne Pepper",
            "Pi√±a": "Pineapple",
            "Pistachos": "Pistachios",
            "Pl√°tano": "Banana",
            "Pollo": "Chicken",
            "Polvo de Hornear": "Baking Powder",
            "Quinoa": "Quinoa",
            "R√°bano": "Radish",
            "Reques√≥n": "Cottage Cheese",
            "Ricotta": "Ricotta",
            "Romero": "Rosemary",
            "R√∫cula": "Arugula",
            "Sal": "Salt",
            "Salm√≥n": "Salmon",
            "Salchicha": "Sausage",
            "Sand√≠a": "Watermelon",
            "Salsa de Soja": "Soy Sauce",
            "Tomate": "Tomato",
            "Tomillo": "Thyme",
            "Tortilla": "Tortilla",
            "Trigo": "Wheat",
            "Trucha": "Trout",
            "Uva": "Grape",
            "Vainilla": "Vanilla",
            "Vinagre": "Vinegar",
            "Yogur": "Yogurt",
            "Zanahoria": "Carrot"
        };

        let ingredients = Object.keys(ingredientTranslations);
        let selectedIngredients = [];
        let recipes = [];
        let inventory = [];

        // Cargar datos desde localStorage
        let customIngredients = JSON.parse(localStorage.getItem('customIngredients')) || {};
        let storedInventory = JSON.parse(localStorage.getItem('inventory')) || [];

        // Obtener imagen del ingrediente
        function getIngredientImage(ingredient) {
            if (customIngredients[ingredient.toLowerCase()]) {
                return customIngredients[ingredient.toLowerCase()].image;
            }
            let translated = ingredientTranslations[ingredient] || ingredient;
            if (ingredient.toLowerCase() === "acelga") {
                return "img/acelga.jpg";
            }
            const imageUrl = `https://www.themealdb.com/images/ingredients/${translated}.png`;
            return imageUrl;
        }

        // Cargar lista de ingredientes
        function loadIngredients() {
            ingredients = [...new Set([...ingredients, ...Object.keys(customIngredients)])];
            updateIngredientSelect(ingredients);
        }

        // Actualizar el select con los ingredientes filtrados
        function updateIngredientSelect(ingredientsToShow) {
            const ingredientSelect = document.getElementById('ingredient-select');
            ingredientSelect.innerHTML = '';
            ingredientsToShow.forEach(ingredient => {
                const option = document.createElement('option');
                option.value = ingredient;
                option.textContent = ingredient;
                const stock = inventory.find(item => item.name.toLowerCase() === ingredient.toLowerCase());
                if (stock && isLowStock(stock.quantity)) {
                    option.style.color = 'red';
                    option.textContent += ' - ¬°Falta reponer!';
                }
                ingredientSelect.appendChild(option);
            });
        }

        // Filtrar ingredientes en tiempo real
        document.getElementById('ingredient-search').addEventListener('input', () => {
            const searchValue = document.getElementById('ingredient-search').value.toLowerCase();
            const filteredIngredients = ingredients.filter(ingredient =>
                ingredient.toLowerCase().includes(searchValue)
            );
            updateIngredientSelect(filteredIngredients);
        });

        // Verificar si el stock es bajo
        function isLowStock(quantity) {
            const num = parseFloat(quantity);
            if (isNaN(num)) return false;
            return num < 0.5; // Ejemplo: menos de 500g o 0.5 unidades
        }

        // Cargar inventario
        function loadInventory() {
            inventory = storedInventory;
            updateInventoryTable();
        }

        // Actualizar la tabla de inventario
        function updateInventoryTable() {
            const inventoryList = document.getElementById('inventory-list');
            inventoryList.innerHTML = '';
            inventory.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td class="${isLowStock(item.quantity) ? 'low-stock' : ''}">
                        ${item.quantity}${isLowStock(item.quantity) ? ' - ¬°Falta reponer!' : ''}
                    </td>
                    <td>${item.message || '-'}</td>
                    <td>
                        <button class="edit-btn" data-index="${index}">Editar</button>
                        <button class="delete-btn" data-index="${index}">Eliminar</button>
                    </td>
                `;
                inventoryList.appendChild(row);
            });
        }

        // Manejar el formulario de inventario
        document.getElementById('inventory-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const itemName = document.getElementById('inventory-item').value.trim();
            const quantity = document.getElementById('inventory-quantity').value.trim();
            const message = document.getElementById('inventory-message').value.trim();
            const editingIndex = document.getElementById('inventory-form').dataset.editingIndex;

            if (editingIndex !== undefined && editingIndex !== '') {
                inventory[editingIndex] = { name: itemName, quantity, message };
                delete document.getElementById('inventory-form').dataset.editingIndex;
            } else {
                inventory.push({ name: itemName, quantity, message });
            }

            localStorage.setItem('inventory', JSON.stringify(inventory));
            updateInventoryTable();
            updateIngredientSelect(ingredients);
            document.getElementById('inventory-form').reset();
        });

        // Editar √≠tem del inventario
        function editInventoryItem(index) {
            const item = inventory[index];
            document.getElementById('inventory-item').value = item.name;
            document.getElementById('inventory-quantity').value = item.quantity;
            document.getElementById('inventory-message').value = item.message || '';
            document.getElementById('inventory-form').dataset.editingIndex = index;
        }

        // Eliminar √≠tem del inventario
        function deleteInventoryItem(index) {
            inventory.splice(index, 1);
            localStorage.setItem('inventory', JSON.stringify(inventory));
            updateInventoryTable();
            updateIngredientSelect(ingredients);
        }

        // Delegaci√≥n de eventos para botones de inventario
        document.getElementById('inventory-list').addEventListener('click', (e) => {
            if (e.target.classList.contains('edit-btn')) {
                editInventoryItem(e.target.getAttribute('data-index'));
            } else if (e.target.classList.contains('delete-btn')) {
                deleteInventoryItem(e.target.getAttribute('data-index'));
            }
        });

        // A√±adir ingredientes con validaci√≥n de inventario
        document.getElementById('add-ingredients-btn').addEventListener('click', () => {
            const selectedOptions = Array.from(document.getElementById('ingredient-select').selectedOptions);
            selectedOptions.forEach(option => {
                const ingredient = option.value;
                const stock = inventory.find(item => item.name.toLowerCase() === ingredient.toLowerCase());
                if (!stock || isLowStock(stock.quantity)) {
                    alert(`Advertencia: ${ingredient} tiene stock bajo o no est√° disponible.`);
                    return;
                }
                const quantity = prompt(`¬øCu√°ntos ${ingredient} necesitas?`);
                if (quantity) {
                    const message = stock ? stock.message : '';
                    selectedIngredients.push({ ingredient, quantity, message });
                    if (stock) {
                        const numStock = parseFloat(stock.quantity);
                        const numUsed = parseFloat(quantity);
                        if (!isNaN(numStock) && !isNaN(numUsed)) {
                            stock.quantity = (numStock - numUsed).toFixed(2) + (stock.quantity.match(/[a-zA-Z]+/) || [''])[0];
                            if (parseFloat(stock.quantity) <= 0) {
                                inventory = inventory.filter(item => item.name !== stock.name);
                            }
                            localStorage.setItem('inventory', JSON.stringify(inventory));
                            updateInventoryTable();
                            updateIngredientSelect(ingredients);
                        }
                    }
                }
            });
            updateSelectedIngredients();
        });

        // Eliminar ingrediente seleccionado
        function removeIngredient(ingredientName) {
            selectedIngredients = selectedIngredients.filter(({ ingredient }) => ingredient !== ingredientName);
            updateSelectedIngredients();
        }

        // Actualizar lista de ingredientes seleccionados
        function updateSelectedIngredients() {
            const selectedIngredientsDiv = document.getElementById('selected-ingredients');
            selectedIngredientsDiv.innerHTML = selectedIngredients
                .map(({ ingredient, quantity, message }) => `
                    <div style="display: flex; align-items: center; margin-bottom: 5px;">
                        <img src="${getIngredientImage(ingredient)}" 
                             alt="${ingredient}" 
                             style="width:30px; height:30px; margin-right:10px;"
                             onerror="this.src='https://via.placeholder.com/30?text=${ingredient}';">
                        <span>${ingredient} (${quantity})${message ? ' - ' + message : ''}</span>
                        <button class="remove-ingredient" data-ingredient="${ingredient}" 
                                style="margin-left:10px; background-color:#d9534f; color:white; border:none; 
                                       padding:2px 5px; font-size:12px; width: 20px; height: 20px; cursor:pointer; 
                                       display:flex; align-items:center; justify-content:center; border-radius:50%;">
                            ‚ùå
                        </button>
                    </div>
                `)
                .join('');

            document.querySelectorAll('.remove-ingredient').forEach(button => {
                button.addEventListener('click', () => {
                    removeIngredient(button.getAttribute('data-ingredient'));
                });
            });
        }

        // Cargar recetas guardadas
        function loadRecipesFromStorage() {
            const storedRecipes = localStorage.getItem('recipes');
            if (storedRecipes) {
                recipes = JSON.parse(storedRecipes);
                const recipesList = document.getElementById('recipes-list');
                recipesList.innerHTML = '';
                recipes.forEach((recipe, index) => displayRecipe(recipe, index));
            }
        }

        // Mostrar recetas
        function displayRecipe(recipe, index) {
            const recipeCard = document.createElement('div');
            recipeCard.classList.add('recipe-card');
            recipeCard.setAttribute('data-index', index);
            const isViable = recipe.ingredients.every(({ ingredient }) => {
                const stock = inventory.find(item => item.name.toLowerCase() === ingredient.toLowerCase());
                return stock && !isLowStock(stock.quantity);
            });
            recipeCard.innerHTML = `
                <h3>${recipe.name}${isViable ? '' : ' <span style="color:red">(Ingredientes insuficientes)</span>'}</h3>
                <p><strong>Ingredientes:</strong></p>
                <div>
                    ${recipe.ingredients.map(({ ingredient, quantity, message }, idx) => `
                        <div style="display: flex; align-items: center; margin-bottom: 5px;">
                            <img src="${recipe.images[idx]}" alt="${ingredient}" style="width:50px; height:50px; margin-right:10px;"
                                 onerror="this.src='https://via.placeholder.com/50?text=${ingredient}';">
                            <span>${ingredient} (${quantity})${message ? ' - ' + message : ''}</span>
                        </div>
                    `).join('')}
                </div>
                <p><strong>Pasos:</strong> ${recipe.steps}</p>
                <button class="edit-recipe-btn" data-index="${index}">Editar</button>
                <button class="delete-recipe-btn" data-index="${index}">Eliminar</button>
                <button class="print-recipe-btn" data-index="${index}">Imprimir</button>
            `;
            document.getElementById('recipes-list').appendChild(recipeCard);
        }

        // Guardar receta
        document.getElementById('recipe-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const recipeName = document.getElementById('recipe-name').value;
            const steps = document.getElementById('steps').value;
            const images = selectedIngredients.map(ingredient => getIngredientImage(ingredient.ingredient));
            const recipe = { name: recipeName, ingredients: selectedIngredients, steps, images };
            const editingIndex = document.getElementById('recipe-form').dataset.editingIndex;

            if (editingIndex !== undefined && editingIndex !== '') {
                recipes[editingIndex] = recipe;
                delete document.getElementById('recipe-form').dataset.editingIndex;
            } else {
                recipes.push(recipe);
            }

            localStorage.setItem('recipes', JSON.stringify(recipes));
            document.getElementById('recipes-list').innerHTML = '';
            recipes.forEach((recipe, index) => displayRecipe(recipe, index));
            document.getElementById('recipe-form').reset();
            selectedIngredients = [];
            updateSelectedIngredients();
        });

        // Editar receta
        function editRecipe(index) {
            const recipe = recipes[index];
            document.getElementById('recipe-name').value = recipe.name;
            document.getElementById('steps').value = recipe.steps;
            selectedIngredients = [...recipe.ingredients];
            updateSelectedIngredients();
            document.getElementById('recipe-form').dataset.editingIndex = index;
        }

        // Eliminar receta
        function deleteRecipe(index) {
            recipes.splice(index, 1);
            localStorage.setItem('recipes', JSON.stringify(recipes));
            document.getElementById('recipes-list').innerHTML = '';
            recipes.forEach((recipe, idx) => displayRecipe(recipe, idx));
        }

        // Imprimir receta
        function printRecipe(index) {
            const recipe = recipes[index];
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>${recipe.name}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { font-size: 24px; }
                        h2 { font-size: 18px; margin-top: 20px; }
                        .ingredient { display: flex; align-items: center; margin-bottom: 10px; }
                        img { width: 50px; height: 50px; margin-right: 10px; }
                        .message { font-style: italic; color: #555; }
                    </style>
                </head>
                <body>
                    <h1>${recipe.name}</h1>
                    <h2>Ingredientes</h2>
                    <div>
                        ${recipe.ingredients.map(({ ingredient, quantity, message }, idx) => `
                            <div class="ingredient">
                                <img src="${recipe.images[idx]}" alt="${ingredient}" 
                                     onerror="this.src='https://via.placeholder.com/50?text=${ingredient}';">
                                <span>${ingredient} (${quantity})${message ? ' <span class="message">- ' + message + '</span>' : ''}</span>
                            </div>
                        `).join('')}
                    </div>
                    <h2>Pasos</h2>
                    <p>${recipe.steps}</p>
                    <script>window.print(); window.close();<\/script>
                </body>
                </html>
            `);
            printWindow.document.close();
        }

        // Delegaci√≥n de eventos para recetas
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('edit-recipe-btn')) {
                editRecipe(e.target.getAttribute('data-index'));
            } else if (e.target.classList.contains('delete-recipe-btn')) {
                deleteRecipe(e.target.getAttribute('data-index'));
            } else if (e.target.classList.contains('print-recipe-btn')) {
                printRecipe(e.target.getAttribute('data-index'));
            }
        });

        // Borrar todas las recetas
        document.getElementById('clearRecipes').addEventListener('click', () => {
            document.getElementById('recipes-list').innerHTML = '';
            recipes = [];
            localStorage.removeItem('recipes');
        });

        // Agregar nuevo ingrediente
        document.getElementById('add-ingredient-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const newIngredientName = document.getElementById('new-ingredient-name').value.trim();
            const newIngredientImage = document.getElementById('new-ingredient-image').value.trim();

            if (newIngredientName && newIngredientImage) {
                customIngredients[newIngredientName.toLowerCase()] = { image: newIngredientImage };
                localStorage.setItem('customIngredients', JSON.stringify(customIngredients));
                if (!ingredients.includes(newIngredientName)) {
                    ingredients.push(newIngredientName);
                    updateIngredientSelect(ingredients);
                }
                document.getElementById('add-ingredient-form').reset();
                alert('Ingrediente agregado con √©xito!');
            } else {
                alert('Por favor, completa todos los campos.');
            }
        });

        // Inicializaci√≥n
        document.addEventListener("DOMContentLoaded", function () {
            loadIngredients();
            loadRecipesFromStorage();
            loadInventory();
            emailjs.init("hqLFCpK3qVkTF0Fdk");

            const commentForm = document.getElementById("comment-form");
            if (commentForm) {
                commentForm.addEventListener("submit", function (event) {
                    event.preventDefault();
                    const name = document.getElementById("name").value.trim();
                    const email = document.getElementById("email").value.trim();
                    const comment = document.getElementById("comment").value.trim();

                    if (!name || !email || !comment) {
                        alert("Por favor, completa todos los campos.");
                        return;
                    }

                    const formData = { name, email, comment };
                    emailjs.send("service_3a04o94", "template_3lb7au9", formData)
                        .then(function () {
                            alert("Comentario enviado con √©xito.");
                            commentForm.reset();
                        })
                        .catch(function () {
                            alert("Ocurri√≥ un error al enviar el comentario.");
                        });
                });
            }
        });

        // Scroll al contenido
        document.getElementById('scrollToContentBtn').addEventListener('click', () => {
            document.getElementById('mainContent').scrollIntoView({ behavior: 'smooth' });
        });
    </script>
    <br>
    <br>
    <footer>
        <p>Desarrollado para Escuela Especial N¬∞ 2031</p>
        <p>¬© 2025 Todos los derechos reservados.</p>
    </footer>
</body>
</html>
